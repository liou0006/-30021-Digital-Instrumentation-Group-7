#include "sensors.h"

//#include <string.h>

// Dummy sample data for sensor at rest (25 samles)
//lsm9ds1_raw_data_t dummy_data[25] = {
//    {64, 56, 16410, 24, -13, 11, 438, -314, 1276},
//    {-13, 63, 16390, 4, -11, 10, 361, -184, 1243},
//    {57, 118, 16335, 46, -3, 1, 440, -182, 1263},
//    {82, 3, 16428, 24, -33, -2, 456, -190, 1322},
//    {43, -8, 16382, 21, -14, 13, 546, -248, 1144},
//    {63, 51, 16373, 22, -1, 2, 367, -231, 1143},
//    {50, 75, 16394, -20, -24, -11, 548, -137, 1316},
//    {-1, 101, 16402, 32, -20, -7, 364, -220, 1312},
//    {30, 73, 16345, 16, -23, -7, 388, -32, 1098},
//    {70, 8, 16423, 19, 4, -14, 480, -218, 1075},
//    {61, 19, 16353, 23, 5, 10, 517, -226, 1121},
//    {51, -17, 16361, 28, -19, -6, 432, -193, 1248},
//    {27, 33, 16380, 31, -21, -1, 402, -173, 1232},
//    {38, 71, 16330, 22, -33, 12, 393, -158, 1181},
//    {49, 11, 16444, 11, -35, -3, 513, -288, 1188},
//    {-2, 107, 16371, 15, -10, 4, 435, -43, 1142},
//    {100, 24, 16374, 27, 11, -1, 269, -128, 1223},
//    {54, -23, 16365, 22, -14, -1, 379, -272, 1250},
//    {12, 23, 16392, 10, 5, -4, 500, -151, 1175},
//    {79, 83, 16348, 34, -41, 1, 438, -281, 1048},
//    {76, 21, 16417, 17, -28, 14, 509, -192, 1118},
//    {38, 8, 16378, -1, -32, 8, 348, -155, 1238},
//    {63, 78, 16401, 23, 1, 3, 313, -72, 1202},
//    {78, 41, 16384, 15, -12, 1, 464, -140, 1193},
//    {21, 55, 16384, 33, -27, -10, 503, -228, 1266}
//};


//// Moving up and down x-axis
//#define NUM_RAW_SAMPLES 39
//lsm9ds1_raw_data_t dummy_data[NUM_RAW_SAMPLES] = {
//    { 22, 1401, 146, 22285, -1510, -5780, 837, 706, 145, 18 },
//    { 267, -1818, 5, 21117, -1199, -6727, 850, 671, 147, 18 },
//    { 60, -2892, 193, 14121, -1387, 809, 1070, 620, -130, 18 },
//    { -10, -631, 64, 6601, 205, 3449, 1261, 529, -322, 18 },
//    { 294, 2694, -468, 8638, 0, 2273, 1211, 580, -286, 18 },
//    { 92, 3374, 659, 17508, -2607, -5086, 901, 702, 94, 18 },
//    { 21, 326, 185, 25972, -1047, -12034, 664, 718, 268, 19 },
//    { -47, -2460, -109, 17417, -843, -6731, 797, 679, 192, 18 },
//    { -85, -2515, 175, 12215, -150, 840, 1051, 637, -79, 19 },
//    { 131, 439, -131, 4074, 853, 1968, 1183, 568, -238, 18 },
//    { 379, 3942, -606, 10508, -2418, -2257, 981, 708, 22, 19 },
//    { -188, 1414, 124, 29026, -1421, -12506, 664, 718, 286, 19 },
//    { 163, -2684, 264, 20229, -1852, -9220, 731, 709, 240, 19 },
//    { -66, -3037, 311, 13605, -1128, -309, 1047, 644, -79, 19 },
//    { 75, -739, 214, 5711, 1248, 2636, 1214, 577, -280, 19 },
//    { 452, 2994, -780, 8451, -2020, -872, 1166, 626, -199, 19 },
//    { 14, 2881, 25, 24416, -3724, -7856, 810, 748, 190, 19 },
//    { 107, -1248, 357, 23933, -2352, -9039, 700, 746, 237, 19 },
//    { 59, -3169, 373, 15263, -1606, -1142, 953, 659, 58, 19 },
//    { -102, -1270, 346, 6046, 220, 433, 1207, 592, -252, 19 },
//    { 401, 3155, -743, 6116, 959, 1048, 1189, 568, -166, 19 },
//    { -383, 3491, -370, 23690, -5187, -12068, 769, 735, 230, 19 },
//    { 164, -1190, 139, 26423, -3052, -12081, 591, 760, 310, 19 },
//    { -25, -4550, 687, 15957, -2343, -4590, 962, 665, 58, 19 },
//    { -495, -2490, 247, 5723, 98, -268, 1302, 569, -299, 19 },
//    { 571, 1504, -354, 5828, 825, 3107, 1365, 572, -315, 19 },
//    { 267, 4350, -291, 17074, -3128, -2484, 1026, 684, 7, 19 },
//    { -179, 1128, 311, 27156, -3750, -11198, 684, 749, 274, 19 },
//    { -55, -2340, 199, 18579, -2018, -6965, 773, 725, 222, 19 },
//    { -272, -2567, -8, 12826, -676, 369, 1021, 693, 11, 19 },
//    { 188, 491, 2, 5304, 834, 2314, 1177, 660, -164, 19 },
//    { 483, 3518, -310, 13627, -3311, -3746, 975, 717, 55, 19 },
//    { 11, 528, 76, 25732, -3751, -10937, 735, 753, 248, 19 },
//    { -181, -2243, 195, 16373, -2359, -6116, 836, 711, 171, 19 },
//    { -81, -2335, 316, 12168, -878, 1139, 1084, 670, -76, 19 },
//    { 330, 1253, -395, 5745, 234, 473, 1143, 658, -168, 19 },
//    { 395, 3222, -347, 17588, -3266, -3614, 954, 728, 77, 19 },
//    { -86, -285, 106, 27268, -3740, -9792, 739, 765, 233, 19 }
//};

/*
// Lying still turned down
#define NUM_RAW_SAMPLES 21
lsm9ds1_raw_data_t dummy_data[NUM_RAW_SAMPLES] = {
    {56, 53, 2, -76, -253, -16441, -471, 572, 518, 17},  // Sample 1
    {48, 54, 4, -29, -229, -16433, -470, 579, 538, 17},  // Sample 2
    {54, 50, 5, -38, -241, -16406, -474, 579, 538, 17},  // Sample 3
    {52, 54, 8, -87, -224, -16413, -459, 596, 524, 18},  // Sample 4
    {55, 58, 1, -101, -216, -16426, -472, 587, 518, 18}, // Sample 5
    {52, 54, 4, -90, -260, -16402, -463, 582, 524, 17},  // Sample 6
    {55, 52, 4, -26, -241, -16416, -470, 593, 527, 18},  // Sample 7
    {50, 50, 6, -69, -239, -16461, -461, 578, 535, 18},  // Sample 8
    {51, 49, 4, -99, -261, -16389, -462, 583, 520, 18},  // Sample 9
    {49, 52, 9, -114, -218, -16442, -476, 589, 521, 18}, // Sample 10
    {49, 51, 7, -38, -204, -16473, -472, 584, 519, 18},  // Sample 11
    {58, 57, 7, -68, -289, -16428, -475, 574, 523, 17},  // Sample 12
    {50, 54, 4, -60, -257, -16438, -460, 582, 533, 17},  // Sample 13
    {51, 56, 4, -73, -243, -16452, -468, 595, 521, 17},  // Sample 14
    {54, 54, 3, -88, -230, -16435, -473, 591, 527, 18},  // Sample 15
    {54, 55, 3, -57, -240, -16428, -468, 574, 538, 18},  // Sample 16
    {51, 49, 26, -64, -240, -16425, -473, 587, 516, 17}, // Sample 17
    {50, 55, 3, -65, -244, -16450, -475, 586, 528, 17},  // Sample 18
    {51, 60, -1, -108, -250, -16397, -466, 577, 537, 18},// Sample 19
    {57, 54, 4, -91, -250, -16460, -467, 590, 532, 18},  // Sample 20
    {55, 63, 7, -78, -238, -16426, -466, 574, 547, 17}   // Sample 21
};
*/


// Moving up and down x-axis
#define NUM_RAW_SAMPLES 49
lsm9ds1_raw_data_t dummy_data[NUM_RAW_SAMPLES] = {
	{46,     42,     -2,     12836,  -346,   -9652,  439,    1022,   -193,   14},
	{44,     45,     0,      13003,  -329,   -9569,  444,    1026,   -173,   14},
	{46,     43,     4,      12843,  -400,   -9643,  443,    1027,   -162,   14},
	{41,     47,     -1,     12920,  -445,   -9715,  443,    1033,   -154,   14},
	{47,     47,     1,      12893,  -372,   -9692,  442,    1028,   -160,   14},
	{44,     51,     3,      12853,  -399,   -9659,  431,    1033,   -179,   14},
	{46,     48,     2,      12960,  -420,   -9721,  446,    1020,   -173,   14},
	{51,     48,     3,      12814,  -419,   -9612,  432,    1035,   -164,   14},
	{45,     52,     3,      13028,  -375,   -9830,  440,    1032,   -156,   14},
	{45,     36,     -3,     12865,  -399,   -9584,  438,    1027,   -165,   14},
	{40,     54,     0,      12834,  -410,   -9641,  446,    1034,   -165,   14},
	{50,     48,     -3,     12920,  -394,   -9690,  428,    1024,   -176,   14},
	{47,     50,     1,      12903,  -389,   -9738,  438,    1029,   -159,   14},
	{44,     44,     -1,     12939,  -365,   -9694,  442,    1023,   -189,   14},
	{47,     46,     2,      12837,  -394,   -9663,  434,    1029,   -156,   14},
	{45,     47,     1,      12866,  -444,   -9691,  433,    1037,   -169,   14},
	{48,     50,     1,      12875,  -414,   -9677,  429,    1029,   -159,   14},
	{42,     41,     1,      12816,  -386,   -9657,  434,    1030,   -168,   14},
	{45,     47,     2,      12865,  -375,   -9674,  446,    1026,   -174,   14},
	{46,     44,     -3,     12860,  -445,   -9645,  450,    1027,   -169,   14},
	{56,     47,     -1,     12878,  -410,   -9718,  446,    1010,   -183,   14},
	{45,     44,     1,      12919,  -403,   -9703,  441,    1029,   -158,   14},
	{45,     50,     0,      12883,  -384,   -9681,  431,    1032,   -170,   14},
	{48,     50,     0,      12910,  -384,   -9713,  430,    1020,   -167,   14},
	{47,     48,     3,      12927,  -396,   -9687,  433,    1035,   -165,   14},
	{50,     48,     4,      12922,  -418,   -9692,  431,    1019,   -183,   14},
	{49,     50,     2,      12883,  -409,   -9689,  424,    1026,   -170,   14},
	{48,     43,     2,      12910,  -432,   -9688,  438,    1024,   -178,   14},
	{49,     45,     3,      12865,  -403,   -9732,  430,    1027,   -171,   14},
	{46,     46,     2,      12861,  -396,   -9700,  442,    1021,   -171,   14},
	{47,     44,     2,      12843,  -382,   -9692,  434,    1015,   -181,   14},
	{49,     49,     2,      12901,  -405,   -9707,  440,    1034,   -173,   14},
	{48,     49,     5,      12872,  -416,   -9698,  430,    1021,   -175,   14},
	{51,     49,     3,      12874,  -367,   -9686,  433,    1017,   -160,   14},
	{45,     47,     2,      12923,  -425,   -9671,  434,    1026,   -183,   14},
	{53,     50,     3,      12857,  -449,   -9629,  435,    1020,   -177,   14},
	{55,     56,     4,      12940,  -389,   -9759,  441,    1015,   -176,   14},
	{49,     49,     1,      12877,  -420,   -9672,  441,    1029,   -180,   14},
	{44,     48,     4,      12931,  -413,   -9712,  430,    1030,   -168,   14},
	{50,     46,     -4,     12903,  -393,   -9681,  426,    1019,   -173,   14},
	{44,     46,     -1,     12900,  -394,   -9680,  429,    1012,   -172,   14},
	{45,     47,     2,      12924,  -411,   -9676,  436,    1031,   -179,   14},
	{48,     48,     1,      12864,  -410,   -9740,  430,    1015,   -178,   14},
	{48,     47,     1,      12882,  -455,   -9738,  440,    1019,   -186,   14},
	{49,     47,     1,      12874,  -375,   -9648,  440,    1018,   -162,   14},
	{50,     50,     3,      12912,  -389,   -9700,  427,    1018,   -166,   14},
	{47,     49,     -3,     12917,  -397,   -9690,  437,    1033,   -185,   14},
	{46,     45,     2,      12884,  -401,   -9734,  445,    1025,   -170,   14},
	{49,     44,     -5,     12936,  -433,   -9687,  447,    1020,   -192,   14}
};




void sensors_read_samples(lsm9ds1_raw_data_t *data, int n_samples) {
	if (!data || n_samples <= 0) return;

	// Copy dummy_data into data, cycling if n_samples > NUM_RAW_SAMPLES
	for (int i = 0; i < n_samples; i++) {
		// Cycle through dummy data (we only copy the number of data samples we have into it.
		data[i] = dummy_data[i % NUM_RAW_SAMPLES];
	}
}

int16_t get_data_val(lsm9ds1_raw_data_t *data, int i, sensor_t sensor,
		axis_t axis) {
	int16_t val;

	switch (axis) {
	case AXIS_X:
		if (sensor == SENSOR_ACCEL) val = data[i].ax;
		else if (sensor == SENSOR_GYRO) val = data[i].gx;
		else val = data[i].mx;
		break;

	case AXIS_Y:
		if (sensor == SENSOR_ACCEL) val = data[i].ay;
		else if (sensor == SENSOR_GYRO) val = data[i].gy;
		else val = data[i].my;
		break;

	case AXIS_Z:
		if (sensor == SENSOR_ACCEL) val = data[i].az;
		else if (sensor == SENSOR_GYRO) val = data[i].gz;
		else val = data[i].mz;
		break;
	}

	return val;
}
